# suib_to_gossopka_connector

  Установка коннектора к СУИБ к ГосСОПКА
1.	Технические требования к аппаратной части и программному обеспечению

Ubuntu 20.04
Python 3.8.10 и выше
2 GB
2 CPU
50 GB для хранения файлов операционной системы
10 GB для хранения журналов коннектора


Windows Server 2012
Python 3.8.10 и выше
2 GB
2 CPU
50 GB для хранения файлов операционной системы
10 GB для хранения журналов коннектора

Не протестированная конфигурация
Centos,RHEL,Debian

2.	Установка коннектора на сервер c ОС Ubuntu
2.1   Установка дистрибутива
1)	Проверить установленную версию Python с помощью команды:
 python3 --version

2)	Проверить версию менеджера пакетов Python c помощью команды:
 pip --version
 
*если используется версия Python 2, то следует использовать версию менеджера пакетов pip3

3)	Установить пакеты xmltodict и request с помощью команд:
pip install xmltodict
pip install requests

4)	Скачать последнюю версию коннектора с облака https://disk.yandex.ru/d/E5aQw8FPC-i8FQ и скопировать содержимое архива на целевой сервер.

5)	Открыть файл connector.py в текстовом редакторе, убедиться, что версия python совпадает с той, что установлена на сервере (п.1). 
Пример:
 
6)	Сделать скрипт исполняемым c помощью команды:
chmod +x connector.py

  2.2   Выполнение настроек файла settings.json
{
  "general_settings": {
    "log_level": "DEBUG", - детализация журналов
    "log_path": "/home/testuser/connector/", - путь до хранения журналов коннектора
    "sync_timeout": 300, - время синхронизации событий
    "error_timeout": 5, - время ожидания при возникновении ошибок
    "max_tries": 5, - количество попыток при возникновении ошибок
    "timezone": "+03:00" – часовой пояс
  },
  "gossopka_settings": {
    "ssl": true,  - использовать https, если параметр false, то используется http
    "server_name": "test-lk.cert.gov.ru", - адрес сервера ГосСОПКА
    "server_port": 443, - порт ГосСОПКА
    "server_token": "{токен}", - токен подключения к ГосСОПКА
    "organization": "{название компании}" – наименование компании
  },
  "suib_settings": {
    "ssl": false, - использовать https, если параметр false, то используется http
    "server_name": "{IP}", - адрес сервера СУИБ
    "server_port": 13080, - порт СУИБ
    "account_name": "{логин}", - логин 
    "account_password": "{пароль}", - пароль
    "encrypt": false, - не шифровать учетные данные, если параметр true, то учетные данные будут зашифрованы
    "incident_id_prefix": "{префикс}" – префикс к имени инцидентов
  }
}

2.3   Регистрация службы для коннектора СУИБ к ГосСПОКА
1)	Создать файл службы коннектора с помощью команды:
nano /lib/system/system/suib-sopka.service
 Пример:
 
2)	Внести и сохранить настройки настройки в файл suib-sopka.service:
[Unit]
Description=SUIB to GosSOPKA connector
After=multi-user.target

[Service]
Type=simple
WorkingDirectory=/home/testuser/connector/
ExecStart=/usr/bin/python.3.8 /home/testuser/connector/connector.py

[Install]
WantedBy=multi-user.target

где,
WorkingDirectory – путь до папки с коннектором,
ExecStart – путь до исполняемого файла.

2.4   Проверка работы коннектора
1)	Выполнить проверку успешного запуска службы с помощью команды:
sudo systemctl status suib-sopka.service
2)	Если статус работы коннектора отличается от “Active”, убедиться в корректности выполненных настроек в п.2.1-2.3.

 
3.	Установка коннектора на сервер c ОС Windows
3.1   Установка дистрибутива
1)	Открыть командную строку от имени администратора
2)	Выполнить проверку установленной версии Python с помощью команды:
 python3 --version
3)	Скачать последнюю версию коннектора с облака https://disk.yandex.ru/d/E5aQw8FPC-i8FQ и скопировать содержимое архива на целевой сервер.
Пример:
 
**В отличии от дистрибутива для ОС Ubuntu, установка пакетов не требуется, так как используется виртуальное окружение.

  3.2   Выполнение настроек файла settings.json
{
  “general_settings”: {
    “log_level”: “DEBUG”, - детализация журналов
    «log_path»: «/home/testuser/connector/», - путь до хранения журналов коннектора
    «sync_timeout»: 300, - время синхронизации событий
    «error_timeout»: 5, - время ожидания при возникновении ошибок
    «max_tries»: 5, - количество попыток при возникновении ошибок
    “timezone”: “+03:00” – часовой пояс
  },
  “gossopka_settings”: {
    «ssl»: true,  - использовать https, если параметр false, то используется http
    «server_name»: «test-lk.cert.gov.ru», - адрес сервера ГосСОПКА
    “server_port”: 443, - порт ГосСОПКА
    “server_token”: “{токен}”, - токен подключения к ГосСОПКА
    «organization»: «{название омпании» – наименование компании
  },
  «suib_settings»: {
    «ssl»: false, - использовать https, если параметр false, то используется http
    “server_name”: “{IP}”, - адрес сервера СУИБ
    “server_port”: 13080, - порт СУИБ
    “account_name”: “{логин}”, - логин 
    “account_password”: “{пароль}”, - пароль
    «encrypt»: false, - не шифровать учетные данные, если параметр true, то учетные данные будут зашифрованы
    «incident_id_prefix»: «{префикс}» – префикс к имени инцидентов
  }
}

3.3   Регистрация службы для коннектора СУИБ к ГосСПОКА
1)	Открыть командную строку от имени администратора
2)	Перейти в папку с коннектором с помощью команды:
cd C:\connector\nssm\win64\
3)	Выполнить команду:
nssm install
4)	Выполнить настройки службы:
Application
Details
Shutdown
 
Остальные настройки оставить по умолчанию!
Нажать «Install service».

3.4   Проверка работы коннектора
1)	Выполнить проверку успешного запуска службы с помощью команды:
sс query connector
2)	Если статус работы коннектора отличается от «Running», убедиться в корректности выполненных настроек в п.3.1-3.3.

